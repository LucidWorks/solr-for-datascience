<html>
<head><title>Solr for Data Science</title></head>
<body>
<h1>Introduction</h1>
<div>Solr is a phenomonal tool for data science, allowing you to quickly explore data sets no matter the format and then build out to do a wide variety of analysis across a lot of different data types.  
  In this tutorial, we'll explore how Solr can be used for data science by looking at the <a
      href="http://www.citibikenyc.com/system-data">Citibike</a> data set</div>.

<h1>Getting started</h1>
<div>
  <ul>
    <li>Download the <a href="http://www.citibikenyc.com/system-data">data</a> and copy it to the data directory if you wish to finish the whole tutorial.  Otherwise, just use the samples in this directory.</li>
    <li>Download Solr 5 (or a release candidate if Solr 5 isn't released yet) into this directory and unpack it.</li>
  </ul>
</div>
<h1>Start Solr</h1>

<div>
  <il>
    <li>cd solr-5.0.0 //Or solr-5.0.0-SNAPSHOT -- We'll call this directory $SOLR_HOME</li>
    <li>bin/solr start -cloud</li>
  </il>
</div>
<h1>Solr 5 Citibike Example</h1>

<div>
  <h3>Index the data</h3>

  <div>
    <ul>
      <li>cd $SOLR_HOME/</li>
      <li>bin/solr create_collection -c citi</li>
      <li>bin/post citi ~/projects/lucid/solr-for-datascience/2013-07-citi-sample.csv</li>
    </ul>
  </div>
  <h3>Stretch your legs</h3>

  <div>
    <ul>
      <li><a
          href="http://localhost:8983/solr/citi/browse?&facet=true&facet.field=bikeid&facet.limit=10&facet.field=gender&facet.field=birth_year">Search
        and Browse w/
        Facets</a></li>
      <li><a
          href="http://localhost:8983/solr/citi/browse?&facet=true&facet.field=bikeid&facet.limit=10&facet.field=start_station_name&facet.field=bikeid">Popular
        bikes and stations</a></li>
      <li><a
          href="http://localhost:8983/solr/citi/select?&q=*:*&rows=0&facet=true&facet.field=bikeid&facet.limit=10&facet.date=starttime&facet.date.start=2013-07-01T00:00:00Z&facet.date.end=2013-10-31T11:59:59Z&facet.date.gap=%2B1DAY">Day
        Usage</a></li>
    </ul>
  </div>
  <h3>Breakaway from the peloton</h3>

  <div>
    <ul>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot=start_station_name,end_station_name">Most
        popular trips (station to station)</a></li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot=bikeid,start_station_name,end_station_name">Life
        and times of a bike</a></li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot=gender,start_station_name&facet.limit=20">Most
        popular stations by gender (0 = N/A, 1 = Male, 2 = Female)</a></li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot=usertype,start_station_name&facet.limit=20">Most
        popular stations by customer type</a></li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot=usertype,gender,start_station_name&facet.limit=20">Most
        popular stations by customer type and gender</a></li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot={!stats=piv1}start_station_name,end_station_name&stats=true&stats.field={!tag=piv1}tripduration">City
        planning</a> -- Where should I put my bike lanes?
      </li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot={!stats=piv1}bikeid&stats=true&stats.field={!tag=piv1}tripduration">Bike
        Usage</a> -- Can I optimize maintenance?
      </li>
      <li><a
          href="http://localhost:8983/solr/citi_shard1_replica1/select?q=*%3A*&rows=1&wt=json&indent=true&facet=true&facet.pivot={!stats=piv1}bikeid,start_station_name&stats=true&stats.field={!tag=piv1}tripduration">Life
        and times of a bike with stats</a></li>

    </ul>
  </div>
  <h3>Attack the Hills</h3>

  <div>
    For this example, we want to massage the data a little bit to do the following:
    <ul>
      <li>Create a proper spatial representation of the start and stop stations, since field guessing can't do that</li>
      <li>Map Gender to enumerated types instead of ints, so that it displays better</li>
      <li>Properly handle null birth years w/ dummy data</li>
      <li>Strongly type a few other fields using dynamic field names to be sure we get the exact field type we want. We
        could alternatively setup a schema using the Schema API or edit schema.xml
      </li>
    </ul>
    <h3>Index the data</h3>

    <div>
      <ul>
        <li>cd $SOLR_HOME/</li>
        <li>bin/solr create_collection -c citi</li>
        <li>cd $SOLR_FOR_DATA_SCIENCE_HOME</li>
        <li>python setup.py -i 2013-07-citi-sample.csv -l citi_py</li>
      </ul>
    </div>
    <h3>Example Queries</h3>

    <div>
      <ul>
        <li><a
            href="http://localhost:8983/solr/citi_py/select?q=*:*&rows=0&wt=json&indent=true&facet=true&facet.pivot={!stats=piv1}start_station_name&facet.pivot={!stats=piv2}bikeid_i&stats=true&stats.field={!tag=piv1,piv2}tripduration_i&fq={!geofilt sfield=start_station_location_p}&pt=40.760479,-73.98774&d=2&fl=id, start_station_name, geodist(start_station_location_p)">Stats
          on bike usage for bikes originating within 2 km of Times Square</a></li>
        <li><a
            href="http://localhost:8983/solr/citi_py/select?q=*:*&rows=0&wt=json&indent=true&facet=true&facet.pivot={!stats=piv1}start_station_name&facet.pivot={!stats=piv2}bikeid_i&stats=true&stats.field={!tag=piv1,piv2}tripduration_i&fq={!geofilt sfield=start_station_location_p}&pt=40.760479,-73.98774&d=5&fl=id, start_station_name, geodist(start_station_location_p)">Stats
          on bike usage for bikes originating within 5 km of Times Square</a></li>
        clean up: focus on gender, dates, spatial
        <li><a
            href="http://localhost:8983/solr/citi_py/select?q=*:*&rows=0&wt=json&indent=true&facet=true&facet.pivot={!stats=piv2}bikeid_i&stats=true&stats.field={!tag=piv2}tripduration_i">Bike
          Usage</a></li>
        <li><a
            href="http://localhost:8983/solr/citi_py/select?q=*:*&rows=0&wt=json&indent=true&facet=true&facet.pivot={!stats=piv2}start_station_name&stats=true&stats.field={!tag=piv2}tripduration_i">Station
          Usage</a></li>
        <li><a
            href="http://localhost:8983/solr/citi_py/select?q=*:*&rows=0&wt=json&indent=true&facet=true&facet.pivot={!stats=piv2}start_station_name,end_station_name&stats=true&stats.field={!tag=piv2}tripduration_i">Stats
          about travel between most freq. used stations</a></li>
      </ul>
    </div>
  </div>
  <h1>Sprint Finish!</h1>

  <div>
    Index the full data set using the python script
    <h3>Index ALL the data</h3>

    <div>
      <ul>
        <li>cd $SOLR_HOME/</li>
        <li>bin/solr create_collection -c citi_full</li>
        <li>cd $SOLR_FOR_DATA_SCIENCE_HOME</li>
        <li>python setup.py -i /path/to/full/dataset -l citi_py</li>
      </ul>
    </div>
  </div>

</div>
<h1>Resources</h1>

<div>
  <ul>
    <li>Citi Data: <a href="http://www.citibikenyc.com/system-data">http://www.citibikenyc.com/system-data</a></li>
    <li><a href="http://lucene.apache.org/solr">Get Solr</a>
    <li>Delete a collection: curl "http://localhost:8983/solr/admin/collections?action=DELETE&name=citi"</li>
  </ul>

</div>
</body>
<html>
